[Service]
# Run as the same local user you used for interactive tests
User=azdevops-agent
Group=azdevops-agent

## setup vars to discover java
Environment="JAVA_HOME_17_X64=/usr/lib/jvm/java-17"
Environment="JAVA_HOME=/usr/lib/jvm/java-17"
Environment="VSTS_OVERWRITE_TEMP=1"

# Ensure the agent has normal network access to reach IMDS at 169.254.169.254
PrivateNetwork=no

# Remove restrictive filesystem and namespace protections that can interfere
ProtectSystem=off
ProtectHome=no

# Ensure the original ExecStart is preserved; blank then re-declare if necessary
ExecStart=
ExecStart=/home/azdevops-agent/myagent/runsvc.sh

# Ensure working directory remains the agent folder
WorkingDirectory=/home/azdevops-agent/myagent

[Install]
Alias=azure-agent.service
Alias=vsts-agent.service